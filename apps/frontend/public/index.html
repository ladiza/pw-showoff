<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo Shop</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; background: #f5f5f5; }

    header { background: #2563eb; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    .logo { font-size: 1.5rem; font-weight: bold; cursor: pointer; }
    .search-box { display: flex; gap: 0.5rem; }
    .search-box input { padding: 0.5rem 1rem; border: none; border-radius: 4px; width: 250px; }
    .search-box button { padding: 0.5rem 1rem; background: #1d4ed8; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .search-box button:hover { background: #1e40af; }

    .filters { background: white; padding: 1rem 2rem; border-bottom: 1px solid #e5e7eb; display: flex; gap: 1.5rem; align-items: center; flex-wrap: wrap; }
    .filters label { font-size: 0.875rem; color: #666; }
    .filter-btn { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-size: 0.875rem; }
    .filter-btn:hover { background: #f9fafb; }
    .filter-btn.active { background: #2563eb; color: white; border-color: #2563eb; }
    .checkbox-label { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.875rem; }

    /* Price Range Slider */
    .price-filter { display: flex; align-items: center; gap: 0.75rem; }
    .price-range-container { position: relative; width: 200px; height: 40px; }
    .price-range-track { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; }
    .price-range-selected { position: absolute; top: 50%; transform: translateY(-50%); height: 6px; background: #2563eb; border-radius: 3px; }
    .price-range-container input[type="range"] {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      pointer-events: none;
    }
    .price-range-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #2563eb;
      border: 3px solid white;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .price-range-container input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #2563eb;
      border: 3px solid white;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .price-values { display: flex; gap: 0.5rem; align-items: center; font-size: 0.875rem; font-weight: 500; }
    .price-values span { min-width: 70px; text-align: center; }

    main { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    h1 { color: #333; }
    .product-count { color: #666; font-size: 0.875rem; }

    .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }

    .product-tile { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
    .product-tile:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,0.12); }
    .product-tile__image { height: 160px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; }
    .product-tile__content { padding: 1.25rem; }
    .product-tile__header { display: flex; justify-content: space-between; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem; }
    .product-tile__name { font-size: 1rem; font-weight: 600; color: #333; }
    .product-tile__badge { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
    .product-tile__badge--in-stock { background: #dcfce7; color: #166534; }
    .product-tile__badge--out-of-stock { background: #fee2e2; color: #991b1b; }
    .product-tile__price { color: #2563eb; font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; }
    .product-tile__category { color: #666; font-size: 0.8rem; text-transform: capitalize; }
    .product-tile__actions { margin-top: 1rem; display: flex; gap: 0.5rem; }
    .btn { padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.875rem; cursor: pointer; border: none; }
    .btn--primary { background: #2563eb; color: white; flex: 1; }
    .btn--primary:hover { background: #1d4ed8; }
    .btn--primary:disabled { background: #9ca3af; cursor: not-allowed; }
    .btn--secondary { background: #f3f4f6; color: #374151; }
    .btn--secondary:hover { background: #e5e7eb; }

    .no-results { padding: 3rem; text-align: center; color: #666; background: white; border-radius: 12px; }

    footer { text-align: center; padding: 2rem; color: #666; font-size: 0.875rem; margin-top: 2rem; }
  </style>
</head>
<body>
  <header data-testid="header">
    <div class="logo" data-testid="logo">Demo Shop</div>
    <div class="search-box" data-testid="search-box">
      <input type="text" data-testid="search-input" placeholder="Hledat produkty...">
      <button data-testid="search-button">Hledat</button>
    </div>
  </header>

  <div class="filters" data-testid="filters">
    <label>Kategorie:</label>
    <button class="filter-btn active" data-testid="filter-all" data-category="">V≈°e</button>
    <button class="filter-btn" data-testid="filter-electronics" data-category="electronics">Elektronika</button>
    <button class="filter-btn" data-testid="filter-accessories" data-category="accessories">P≈ô√≠slu≈°enstv√≠</button>
    <button class="filter-btn" data-testid="filter-clothing" data-category="clothing">Obleƒçen√≠</button>

    <div class="price-filter" data-testid="price-filter">
      <label>Cena:</label>
      <div class="price-values">
        <span data-testid="price-min-value">0 Kƒç</span>
        <span>‚Äì</span>
        <span data-testid="price-max-value">100 000 Kƒç</span>
      </div>
      <div class="price-range-container" data-testid="price-range-container">
        <div class="price-range-track"></div>
        <div class="price-range-selected" data-testid="price-range-selected"></div>
        <input type="range" data-testid="price-range-min" min="0" max="100000" value="0" step="100">
        <input type="range" data-testid="price-range-max" min="0" max="100000" value="100000" step="100">
      </div>
    </div>

    <label class="checkbox-label">
      <input type="checkbox" data-testid="filter-in-stock">
      Pouze skladem
    </label>
  </div>

  <main>
    <div class="page-header">
      <h1 data-testid="page-title">Produkty</h1>
      <span class="product-count" data-testid="product-count"></span>
    </div>
    <div data-testid="products-grid" class="products"></div>
  </main>

  <footer data-testid="footer">
    Demo Shop &copy; 2025 | Vytvo≈ôeno pro testovac√≠ √∫ƒçely
  </footer>

  <script>
    const API_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:3000'
      : 'http://backend:3000';

    let currentCategory = '';
    let currentQuery = '';
    let onlyInStock = false;
    let priceMin = 0;
    let priceMax = 100000;
    let allProducts = [];

    async function loadProducts() {
      let endpoint = `${API_URL}/api/products`;
      const params = new URLSearchParams();

      if (currentQuery) {
        endpoint = `${API_URL}/api/search`;
        params.set('q', currentQuery);
      } else {
        if (currentCategory) params.set('category', currentCategory);
        if (onlyInStock) params.set('inStock', 'true');
      }

      const url = params.toString() ? `${endpoint}?${params}` : endpoint;

      try {
        const res = await fetch(url);
        const data = await res.json();
        allProducts = currentQuery ? data.results : data;
        filterAndRender();
      } catch (err) {
        document.querySelector('[data-testid="products-grid"]').innerHTML =
          '<div class="no-results" data-testid="no-results">Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø</div>';
        document.querySelector('[data-testid="product-count"]').textContent = '';
      }
    }

    function filterAndRender() {
      const filtered = allProducts.filter(p => p.price >= priceMin && p.price <= priceMax);
      renderProducts(filtered);
    }

    function renderProducts(products) {
      const container = document.querySelector('[data-testid="products-grid"]');
      const title = document.querySelector('[data-testid="page-title"]');
      const count = document.querySelector('[data-testid="product-count"]');

      if (currentQuery) {
        title.textContent = `V√Ωsledky pro "${currentQuery}"`;
      } else if (currentCategory) {
        const categoryNames = { electronics: 'Elektronika', accessories: 'P≈ô√≠slu≈°enstv√≠', clothing: 'Obleƒçen√≠' };
        title.textContent = categoryNames[currentCategory] || 'Produkty';
      } else {
        title.textContent = 'Produkty';
      }

      count.textContent = `${products.length} produkt≈Ø`;

      if (products.length === 0) {
        container.innerHTML = '<div class="no-results" data-testid="no-results">≈Ω√°dn√© produkty nenalezeny</div>';
        return;
      }

      const icons = { electronics: 'üíª', accessories: 'üéß', clothing: 'üëï' };

      container.innerHTML = products.map(p => `
        <div class="product-tile" data-testid="product-tile" data-product-id="${p.id}">
          <div class="product-tile__image">${icons[p.category] || 'üì¶'}</div>
          <div class="product-tile__content">
            <div class="product-tile__header">
              <h3 class="product-tile__name" data-testid="product-name">${p.name}</h3>
              <span class="product-tile__badge ${p.inStock ? 'product-tile__badge--in-stock' : 'product-tile__badge--out-of-stock'}" data-testid="product-stock">
                ${p.inStock ? 'Skladem' : 'Vyprod√°no'}
              </span>
            </div>
            <div class="product-tile__price" data-testid="product-price">${p.price.toLocaleString('cs-CZ')} Kƒç</div>
            <div class="product-tile__category" data-testid="product-category">${p.category}</div>
            <div class="product-tile__actions">
              <button class="btn btn--primary" data-testid="add-to-cart" ${!p.inStock ? 'disabled' : ''}>
                ${p.inStock ? 'P≈ôidat do ko≈°√≠ku' : 'Nedostupn√©'}
              </button>
              <button class="btn btn--secondary" data-testid="product-detail">Detail</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Price range slider
    const rangeMin = document.querySelector('[data-testid="price-range-min"]');
    const rangeMax = document.querySelector('[data-testid="price-range-max"]');
    const rangeSelected = document.querySelector('[data-testid="price-range-selected"]');
    const minValue = document.querySelector('[data-testid="price-min-value"]');
    const maxValue = document.querySelector('[data-testid="price-max-value"]');

    function updatePriceRange() {
      const min = parseInt(rangeMin.value);
      const max = parseInt(rangeMax.value);

      if (min > max - 500) {
        if (this === rangeMin) {
          rangeMin.value = max - 500;
        } else {
          rangeMax.value = min + 500;
        }
      }

      priceMin = parseInt(rangeMin.value);
      priceMax = parseInt(rangeMax.value);

      minValue.textContent = priceMin.toLocaleString('cs-CZ') + ' Kƒç';
      maxValue.textContent = priceMax.toLocaleString('cs-CZ') + ' Kƒç';

      const percentMin = (priceMin / 100000) * 100;
      const percentMax = (priceMax / 100000) * 100;
      rangeSelected.style.left = percentMin + '%';
      rangeSelected.style.width = (percentMax - percentMin) + '%';

      filterAndRender();
    }

    rangeMin.addEventListener('input', updatePriceRange);
    rangeMax.addEventListener('input', updatePriceRange);

    // Initialize range visual
    updatePriceRange.call(rangeMin);

    // Search
    document.querySelector('[data-testid="search-button"]').addEventListener('click', () => {
      currentQuery = document.querySelector('[data-testid="search-input"]').value;
      loadProducts();
    });

    document.querySelector('[data-testid="search-input"]').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        currentQuery = e.target.value;
        loadProducts();
      }
    });

    // Category filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        currentQuery = '';
        document.querySelector('[data-testid="search-input"]').value = '';
        loadProducts();
      });
    });

    // In stock filter
    document.querySelector('[data-testid="filter-in-stock"]').addEventListener('change', (e) => {
      onlyInStock = e.target.checked;
      loadProducts();
    });

    // Logo click - reset
    document.querySelector('[data-testid="logo"]').addEventListener('click', () => {
      currentCategory = '';
      currentQuery = '';
      onlyInStock = false;
      priceMin = 0;
      priceMax = 100000;
      document.querySelector('[data-testid="search-input"]').value = '';
      document.querySelector('[data-testid="filter-in-stock"]').checked = false;
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('[data-testid="filter-all"]').classList.add('active');
      rangeMin.value = 0;
      rangeMax.value = 100000;
      updatePriceRange.call(rangeMin);
      loadProducts();
    });

    loadProducts();
  </script>
</body>
</html>
